"0","#----------------------------------------------------------------------------- "
"0","# Generate adstock as described in the Google Paper:"
"0","# Bayesian Methods for Media Mix Modeling with Carryover and Shape Effects"
"0","#----------------------------------------------------------------------------- "
"0","library(tidyquant)"
"0","# fake data"
"0","date <- seq(from = as.Date(""2018-01-01""), length.out = 104, by = ""1 week"")"
"0","x    <- c(rep(100,5), rep(0,99)) %>% "
"0","  as_tibble() %>% "
"0","  add_column(date) %>%"
"0","  rename(x = value)"
"0","# -----------------------------------------------------------------------------"
"0","# Name:            Carryover Effect"
"0","#"
"0","# Description:    Two functions are provided for modeling the decay of ad "
"0","#                 effect. "
"0","#"
"0","# Geometric:      This function assumes that week 1 is the most impactfull"
"0","#                 week of the the promo. Subsequent weeks have a slow decline"
"0","#                 as defined by the rate. A larger rate give a slower decline"
"0","#"
"0","# Delayed:        This function assumes that a week after week 1 is the most"
"0","#                 impactfull week. It has a weight that is proportional to "
"0","#                 The normal distribution around the week of impact defined"
"0","#                 by theta"
"0","# -----------------------------------------------------------------------------"
"0","geom_decay    <- function(rate,l,...) sum((rate^l) *...) / sum(rate^l)"
"0","delayed_decay <- function(rate,l,theta,...){"
"0","  sum((rate^(l-theta)^2) *...) / sum(rate^(l-theta)^2) "
"0","}"
"0","# Examples of calculating adstock from both functions"
"0","# Since the values are calculated on a rolling window"
"0","# it is neccesary to used something like tq_mutate"
"0","# to get values for a given time-series"
"0","L = 13"
"0","x %>% "
"0","  tq_mutate(select = x, mutate_fun = rollapply, width = L, align = ""right"","
"0","    FUN = geom_decay,"
"0","    #function args"
"0","    rate = 0.8,"
"0","    l = seq(from = 0 , to = L-1),"
"0","    #ts_mutate"
"0","    col_rename = ""adstock_geometric_decay"""
"0","  )"
